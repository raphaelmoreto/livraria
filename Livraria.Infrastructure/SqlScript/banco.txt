CREATE DATABASE Livraria;

USE Livraria;

CREATE TABLE Categoria (
	id INT PRIMARY KEY IDENTITY(1,1),
	nome VARCHAR(255) NOT NULL
);

CREATE TABLE Autor (
	id INT PRIMARY KEY IDENTITY(1,1),
	nome VARCHAR(255) NOT NULL
);

CREATE TABLE Livro (
	id INT PRIMARY KEY IDENTITY(1,1),
	titulo VARCHAR(255) NOT NULL,
	subtitulo VARCHAR(255) DEFAULT '',
	isbn VARCHAR(15) NOT NULL, --Número Internacional Padronizado de Livro
	dt_publicacao DATETIME NOT NULL,
	codigo_barras VARCHAR(50) NOT NULL,
	preco DECIMAL(18,2) NOT NULL,
	qt_estoque INT NOT NULL DEFAULT 0,
	fk_autor INT,
	fk_categoria INT
);

ALTER TABLE Livro
ADD CONSTRAINT fk_livro_autor
FOREIGN KEY (fk_autor) REFERENCES Autor (id);

ALTER TABLE Livro
ADD CONSTRAINT fk_livro_categoria
FOREIGN KEY (fk_categoria) REFERENCES Categoria (id);

CREATE TABLE Movimentacao (
	id INT PRIMARY KEY IDENTITY(1,1),
	tipo VARCHAR(20) NOT NULL, --ENTRADA OU SAÍDA
	dt_movimentacao DATETIME NOT NULL, --Quando o livro foi cadastrado no sistema
	quantidade INT NOT NULL,
	fk_livro INT NOT NULL
);

ALTER TABLE Movimentacao
ADD CONSTRAINT fk_movimentacao_livro
FOREIGN KEY (fk_livro) REFERENCES Livro (id);